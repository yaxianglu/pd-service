# 账户管理功能指南

## 功能概述
本系统实现了基于角色的账户管理功能，支持不同角色用户创建和管理不同类型的账户。

## 角色权限说明

### 角色定义
系统支持以下角色：

1. **超级管理员** (`super_admin`)
   - 可以管理所有账户类型
   - **注意：此角色不可手动创建，仅系统预设**

2. **普通管理员** (`admin`)
   - 可以管理所有账户类型
   - 可以创建：普通管理员、销售专员、医生

3. **医院管理员** (`hospital`)
   - 可以管理诊所、医生、患者账户
   - **注意：此角色不可手动创建，仅系统预设**

4. **销售专员** (`market`)
   - 可以管理诊所、医生、患者账户
   - 可以创建：销售专员、医生

5. **医生** (`doctor`)
   - 只能管理患者账户
   - 可以创建：患者

### 前端角色选项
在创建用户时，前端下拉列表仅显示可手动创建的角色：
- 普通管理員 (`admin`)
- 銷售專員 (`market`)
- 醫生 (`doctor`)

**隐藏角色**（不可手动创建）：
- 超級管理員 (`super_admin`)
- 醫院管理員 (`hospital`)

## 数据源描述

### 用户数据
- **非患者用户**：存储在 `admin_users` 表中
- **患者用户**：存储在 `smile_test` 表中

### 数据字段映射

#### admin_users 表字段映射
- `id` → `id`
- `username` → `username`
- `full_name` → `full_name`
- `role` → `role`
- `status` → `status`
- `email` → `email`
- `phone` → `phone`
- `created_at` → `created_at`

#### smile_test 表字段映射（患者）
- `test_id` → `patient_id`
- `test_status` → `status`
- `patient_name` → `full_name`
- `patient_phone` → `phone`
- `patient_email` → `email`
- `created_at` → `created_at`

### 状态映射（患者）
前端状态值与后端 `test_status` 字段的映射关系：

| 前端显示 | 后端存储 | 说明 |
|---------|---------|------|
| 活跃 | pending | 患者状态正常 |
| 暂停 | paused | 患者状态暂停 |
| 取消 | cancelled | 患者状态取消 |

## API 接口

### 用户管理接口
- `GET /auth/users` - 获取用户列表
- `POST /auth/users` - 创建用户
- `DELETE /auth/users/:id` - 删除用户

### 诊所管理接口
- `GET /auth/clinics` - 获取诊所列表
- `POST /auth/clinics` - 创建诊所
- `DELETE /auth/clinics/:id` - 删除诊所

### 患者管理接口
- `GET /auth/patients` - 获取患者列表
- `POST /auth/patients` - 创建患者
- `DELETE /auth/patients/:id` - 删除患者

## 修复记录

### 2024-08-11 修复
1. **数据源修正**：修正了患者数据从 `patients` 表改为 `smile_test` 表
2. **参数处理修正**：修正了 API 参数处理方式
3. **角色选项更新**：根据实际数据库角色更新了前端角色选项
4. **角色隐藏**：隐藏了不可手动创建的角色（超级管理员、医院管理员）
5. **状态功能移除**：移除了所有管理模块中的状态列和状态更新功能

### 角色更新详情
- 更新了前端角色下拉选项以匹配数据库中的实际角色
- 添加了角色权限验证
- 隐藏了 `super_admin` 和 `hospital` 角色选项
- 更新了权限控制逻辑以支持新的角色结构

## 使用说明

### 创建用户
1. 选择相应的管理模块（用户/诊所/患者）
2. 点击"创建"按钮
3. 填写必要信息
4. 选择角色（仅显示可创建的角色）
5. 提交表单

### 管理账户
1. 在相应列表中查看账户信息
2. 使用操作按钮进行状态更新或删除操作
3. 根据角色权限，只能管理允许的账户类型

## 注意事项
1. 超级管理员和医院管理员角色不可手动创建
2. 患者数据存储在 `smile_test` 表中，使用 `test_id` 作为主键
3. 删除操作为软删除，不会真正删除数据
4. 角色权限控制仅在前端实现，后端不进行严格验证
5. 所有账户创建时默认密码为 `pd2025!`
6. 医生角色创建时必须绑定诊所
7. 已移除状态管理功能，所有账户默认为激活状态
